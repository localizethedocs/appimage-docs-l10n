

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manual packaging &mdash; AppImage  文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=5111789f" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/appimage-docs-l10n/packaging-guide/manual.html" />
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Testing your AppImage" href="testing.html" />
    <link rel="prev" title="Using the Open Build Service" href="hosted-services/opensuse-build-service.html" />
 
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AppImage
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Packaging Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction to Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="from-source/index.html">Packaging from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="converting-binary-packages/index.html">Converting binary packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="optional/index.html">Optional Resources and Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="hosted-services/index.html">Hosted services</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Manual packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing your AppImage</a></li>
<li class="toctree-l2"><a class="reference internal" href="distribution.html">Distributing AppImages</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment-variables.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AppImage</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Packaging Guide</a></li>
      <li class="breadcrumb-item active">Manual packaging</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AppImage/docs.appimage.org/blob/master/source/packaging-guide/manual.rst" class="fa fa-github"> 在 GitHub 上编辑</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="顺序式页面导航">
        <a href="hosted-services/opensuse-build-service.html" class="btn btn-neutral float-left" title="Using the Open Build Service" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing your AppImage" accesskey="n">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="manual-packaging">
<span id="ref-manual"></span><h1>Manual packaging<a class="headerlink" href="#manual-packaging" title="Link to this heading"></a></h1>
<p>Create an AppDir manually, then turn it into an AppImage. Start out with the example below, then check the examples on bundling certain applications or type of applications as AppImages from the right-hand side <strong>&quot;Pages&quot;</strong> menu.</p>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-an-appdir-manually" id="id1">Creating an AppDir manually</a></p></li>
<li><p><a class="reference internal" href="#no-hard-coded-paths" id="id2">No hard-coded paths</a></p></li>
<li><p><a class="reference internal" href="#creating-an-appimage-from-the-appdir" id="id3">Creating an AppImage from the AppDir</a></p></li>
</ul>
</nav>
<section id="creating-an-appdir-manually">
<span id="ref-creating-an-appdir-manually"></span><h2><a class="toc-backref" href="#id1" role="doc-backlink">Creating an AppDir manually</a><a class="headerlink" href="#creating-an-appdir-manually" title="Link to this heading"></a></h2>
<p>In practice, you will probably never do this by hand. So this is mainly to illustrate the concept.</p>
<p>Create an AppDir structure that looks (as a minimum) like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span>
<span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span><span class="n">AppRun</span>
<span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">desktop</span>
<span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">png</span>
<span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">myapp</span>
<span class="n">MyApp</span><span class="o">.</span><span class="n">AppDir</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libfoo</span><span class="o">.</span><span class="n">so</span><span class="mf">.0</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">AppRun</span></code> file can be a script or executable. It sets up required environment variables such as <code class="code docutils literal notranslate"><span class="pre">$PATH</span></code> and launches the payload application. You can write your own, but in most cases it is easiest (and most error-proof) to use a precompiled one from this repository.</p>
<p>Of course you can leave out the library if your app does not need one, or if all libraries your app needs are already contained in every base operating system you are targeting.</p>
</section>
<section id="no-hard-coded-paths">
<span id="ref-no-hard-coded-paths"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink">No hard-coded paths</a><a class="headerlink" href="#no-hard-coded-paths" title="Link to this heading"></a></h2>
<p>Your binary, myapp, must not contain any hardcoded paths that would prevent it from being relocateable. You can check this by running</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>strings<span class="w"> </span>MyApp.AppDir/usr/bin/myapp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>/usr
</pre></div>
</div>
<p>Should this return something, then you need to modify your app programmatically (e.g., by using relative paths, using <a class="reference external" href="https://github.com/limbahq/binreloc">binreloc</a>, or using <code class="code docutils literal notranslate"><span class="pre">QString</span> <span class="pre">QCoreApplication::applicationDirPath()</span></code>).</p>
<p>If you prefer not to change the source code of your app and/or would not like to recompile your app, you can also patch the binary, for example using the command</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s#/usr#././#g&#39;</span><span class="w"> </span>MyApp.AppDir/usr/bin/myapp
</pre></div>
</div>
<p>This usually works as long as the application is not doing a <code class="code docutils literal notranslate"><span class="pre">chdir()</span></code> which would break this workaround, because then <code class="code docutils literal notranslate"><span class="pre">././</span></code> would not be pointing to <code class="code docutils literal notranslate"><span class="pre">$APPDIR/usr</span></code> any more. You can run the following command to see whether the application is doing a <code class="code docutils literal notranslate"><span class="pre">chdir()</span></code> (99% of GUI applications don't)</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>strace<span class="w"> </span>-echdir<span class="w"> </span>-f<span class="w"> </span>./AppRun
</pre></div>
</div>
<dl class="simple">
<dt>Also see:</dt><dd><p><a class="reference external" href="https://www.gnu.org/software/gnulib/manual/html_node/Supporting-Relocation.html">https://www.gnu.org/software/gnulib/manual/html_node/Supporting-Relocation.html</a></p>
</dd>
</dl>
<p>It has been a pain for many users of GNU packages for a long time that packages are not relocatable. The relocatable-prog module aims to ease the process of making a GNU program relocatable.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The same is true for any helper binaries and/or libraries that your app depends on. You check this and patch it with</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>MyApp.AppDir/usr/
find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s#/usr#././#g&#39;</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
<span class="nb">cd</span><span class="w"> </span>-
</pre></div>
</div>
<p>which replaces all occurrences of <code class="code docutils literal notranslate"><span class="pre">/usr</span></code> with <code class="code docutils literal notranslate"><span class="pre">././</span></code>, which simply means &quot;here&quot;.</p>
</div>
<p>myapp.desktop should contain (as a minimum):</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Desktop Entry]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">MyApp</span>
<span class="na">Exec</span><span class="o">=</span><span class="s">myapp</span>
<span class="na">Icon</span><span class="o">=</span><span class="s">myapp</span>
<span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
<span class="na">Categories</span><span class="o">=</span><span class="s">Utility</span><span class="c1">;</span>
</pre></div>
</div>
<p>Be sure to pick one of the <a class="reference external" href="https://standards.freedesktop.org/menu-spec/latest/apa.html">Registered Categories</a>, and be sure that your desktop file passes validation by using <code class="code docutils literal notranslate"><span class="pre">desktop-file-validate</span> <span class="pre">your.desktop</span></code>. If you are not deploying an application with a graphical user interface (GUI) but a command line tool (for the terminal), make sure to add <code class="code docutils literal notranslate"><span class="pre">Terminal=true</span></code>.</p>
</section>
<section id="creating-an-appimage-from-the-appdir">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Creating an AppImage from the AppDir</a><a class="headerlink" href="#creating-an-appimage-from-the-appdir" title="Link to this heading"></a></h2>
<p>To create an AppImage, run <code class="code docutils literal notranslate"><span class="pre">appimagetool</span></code> on the AppDir in order to turn it into an AppImage. You can get it from this repository's <a class="reference external" href="https://github.com/AppImage/AppImageKit/releases">Releases</a> page (it comes as an AppImage itself; yes, we eat our own dogfood).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="hosted-services/opensuse-build-service.html" class="btn btn-neutral float-left" title="Using the Open Build Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing your AppImage" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2018-2022, The AppImage project。
      <span class="commit">版本 <code>475547d</code>.
      </span></p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>